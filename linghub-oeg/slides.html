<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="author" content="John P. McCrae" />
<title>Linghub: Reconciling Heterogeneous Metadata about Language Resources</title>
<style type="text/css">code{white-space: pre;}</style>
<link href='http://fonts.googleapis.com/css?family=Raleway:400,700' rel='stylesheet' type='text/css'>
<style>
html, .view body { background-color: #111; counter-reset: slideidx; }
body, .view section { background-color: #111; color:#eee; border-radius: 12px }
.black { color:#111; }
.small { font-size: 60%; }
.capt { color: #228b42;font-weight:bold; font-size:115%; }
.emph { color: #228b42; }
.emph2 { color: cornflowerblue; }
figcaption > span { background: #111; padding-bottom:7px; padding-top:3px; padding-right:20px; padding-left:3px;}
figcaption.down { padding-top:100px; }
figcaption.down_more { padding-top:150px; }
iframe { background:white; }
li { list-style-image: url('arrow.png'); }
p.motivation { 
    margin-top: 9em;
    text-align: center;
    background: #ddd;
    font-style: italic;
    color: #111;
    width: 60%;
    margin-left: 20%;
    padding:2px;
}
/* A section is a slide. It's size is 800x600, and this will never change */
section {
    font-family: 'Raleway', Arial, serif;
    font-size: 20pt;
}
address, blockquote, dl, fieldset, form, h1, h2, h3, h4, h5, h6, hr, ol, p, pre, table, ul, dl { padding: 10px 20px 10px 20px; }
h1, h2, h3 {
    text-align: center;
    margin: 10pt 10pt 20pt 10pt;
}
ul, ol {
    margin: 10px 10px 10px 50px;
}
section.titleslide h1 { margin-top: 200px; }
h1.title { margin-top: 150px; }
h1 { font-size: 180%; }
h2 { font-size: 120%; }
h3 { font-size: 100%; }
q { quotes: "“" "”" "‘" "’"; }
blockquote { font-style: italic }
/* Figures are displayed full-page, with the caption on
top of the image/video */
figure {
    background-color: black;
    width: 100%;
    height: 100%;
  }
  figure > * {
    position: absolute;
  }
  figure > img, figure > video {
    width: 100%; height: 100%;
}
figcaption {
    margin: 70px;
}
footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 40px;
    text-align: right;
    background-color: #F3F4F8;
    border-top: 1px solid #CCC;
}

/* Transition effect */
/* Feel free to change the transition effect for original
animations. See here:
https://developer.mozilla.org/en/CSS/CSS_transitions
How to use CSS3 Transitions: */
section {
    -moz-transition: left 400ms linear 0s;
    -webkit-transition: left 400ms linear 0s;
    -ms-transition: left 400ms linear 0s;
    transition: left 400ms linear 0s;
}

/* Before */
section { left: -150%; }
/* Now */
section[aria-selected] { left: 0; }
/* After */
section[aria-selected] ~ section { left: +150%; }

/* Incremental elements */

/* By default, visible */
.incremental > * { opacity: 1; }

/* The current item */
.incremental > *[aria-selected] { color: red; opacity: 1; }

/* The items to-be-selected */
.incremental > *[aria-selected] ~ * { opacity: 0.2; }
</style>
</head>
<body>
<section class="title">
    <h1 class="title"><span class="emph">Linghub</span>: Reconciling <span class="emph2">Heterogeneous</span> Metadata about <span class="emph2">Language Resources</span></h1>
    <h2 class="author">John P. McCrae &mdash; CITEC, Bielefeld University</h2>
    <h3 class="date">16th April 2015</h3>
</section>
<section>
    <figure>
        <img src="londonish.png"/>
        <figcaption class="down_more"><span class="capt">About me</span></figcaption>
    </figure>
</section>

<section>
    <figure>
        <img src="Bielefeld.jpeg"/>
        <figcaption class="down">
        <span>2006-2009: National Institute of Informatics, Tokyo</span><br>
        <span>2009-: Cognitive Interaction Technology, Center of Excellence, Bielefeld University</span><br>
        <span><span class="emph">Monnet</span> and <span class="emph">LIDER</span> projects with UPM</span>
</figcaption>
    </figure>
</section>

<section>
  <h1 class="title">What is Linghub?</h1>

  <h3>Linghub enables people to find <span class="emph">language resources</span> to solve their <span class="emph2">problems</span></h3>
</section>

<section id="problem" class="slide level1">
    <figure>
        <img src="books.jpg">
        <figcaption class="down_more"><span><span class="emph2">Problem</span>: Many <span class="emph">incompatible</span> sources of information about language resources</span></figcaption>
    </figure>
</section>
<section id="datahub" class="slide level1">
    <figure>
        <img src="datahub.png">
        <figcaption class="down_more"><span><span class="capt">Datahub.io</span></span><br><br><span> (Mostly) linked data</span></figcaption>
    </figure>
</section>
<section id="llod-cloud-diagram" class="slide level1">
    <figure style="background-color:#eee">
        <img src="http://linguistic-lod.org/images/llod-cloud-latest.svg">
        <figcaption class="down_more"><span><span class="emph">Linguistic Linked Open Data</span> cloud diagram</span></figcaption>
    </figure>
</section>
<section id="lre-map" class="slide level1">
    <figure>
        <img src="lremap.png">
        <figcaption class="down"><span><span class="capt">LRE Map</span></span><br><br><span>
          Collected from conference participants</span><br><br><span>
            No quality control</span></figcaption>
    </figure>
</section>
<section id="meta-share" class="slide level1">
    <figure>
        <img src="metashare.png">
        <figcaption class="down"><span><span class="capt">META-SHARE</span></span><br><br><span>
          Highly curated resources</span><br><br><span>
            Complex metadata</span></figcaption>
    </figure>
</section>
<section id="clarin-vlo" class="slide level1">
    <figure>
        <img src="clarin.png">
        <figcaption class="down"><span><span class="capt">CLARIN VLO</span></span><br><br><span>
          Collected from many partners</span><br><br><span>
            Metadata scheme is unique to each source</figcaption>
    </figure>
</section>
<section id="linghub" class="slide level1">
    <h1>Linghub</h1>
    <p style="padding-top:100px;font-size:120%;">Goal: Make all these data available on the same <span class="emph">linked data</span> portal</p>
</section>
<section id="data-collection" class="slide level1">
    <h1>Data collection</h1>
    <table style="width:80%;padding-top:100px;">
        <tbody>
        <tr class="odd">
            <td style="text-align: center;">Datahub</td>
            <td style="text-align: center;">via API</td>
        </tr>
        <tr class="even">
            <td style="text-align: center;">LRE Map</td>
            <td style="text-align: center;">Linked Data</td>
        </tr>
        <tr class="odd">
            <td style="text-align: center;">META-SHARE</td>
            <td style="text-align: center;">XML dump</td>
        </tr>
        <tr class="even">
            <td style="text-align: center;">CLARIN VLO</td>
            <td style="text-align: center;">OAI-PMH</td>
        </tr>
        </tbody>
    </table>
</section>
<section id="data-collected" class="slide level1">
    <h1>Data collected</h1>
    <table style="width:100%;padding-top:80px;">
        <thead>
            <tr class="header">
                <th style="text-align: left;">Source</th>
                <th style="text-align: center;">Records</th>
                <th style="text-align: center;">Triples</th>
                <th style="text-align: center;">Triples/Records</th>
            </tr>
        </thead>
        <tbody>
        <tr class="odd">
            <td style="text-align: left;">META-SHARE</td>
            <td style="text-align: center;">2,442</td>
            <td style="text-align: center;">464,572</td>
            <td style="text-align: center;">190.2</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">CLARIN</td>
            <td style="text-align: center;">144,570</td>
            <td style="text-align: center;">3,381,736</td>
            <td style="text-align: center;">23.4</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">Datahub</td>
            <td style="text-align: center;">218</td>
            <td style="text-align: center;">10,739</td>
            <td style="text-align: center;">49.3</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">LRE Map</td>
            <td style="text-align: center;">5,712</td>
            <td style="text-align: center;">79,576</td>
            <td style="text-align: center;">13.9</td>
        </tr>
        </tbody>
    </table>
</section>
<section id="lixr" class="slide level1">
    <h1>LIXR</h1>
    <p>META-SHARE and CLARIN have different and <span class="emph">complex</span> XML schemas</p>
    <p><span class="emph2">Solution:</span></p>
    <p>&quot;Lightweight Invertible XML to RDF&quot;</p>
    <p>A Scala DSL to quickly transform XML to RDF</p>
</section>
<section id="lixr-example---input" class="slide level1">
    <h1>LIXR Example - Input</h1>
    <pre style="padding-top:50px;"><code>&lt;cmd:CMD xmlns:cmd=&quot;...&quot;&gt;
   &lt;cmd:Header&gt;
      &lt;cmd:MdCreator&gt;Bernhard Jackl
      &lt;/cmd:MdCreator&gt;</code></pre>
    <p>To</p>
    <pre><code>&lt;#Header&gt; a dcat:CatalogRecord ;
  dc:creator &quot;Bernhard Jackl&quot; .</code></pre>
</section>
<section id="lixr-example---definition" class="slide level1">
    <h1>LIXR Example - Definition</h1>
    <pre><code>cmd.CMD --&gt; (
  node(&quot;Header&quot;) (
    a &gt; dcat.CatalogRecord,
    handle(cmd.Header),
    ... ))

cmd.Header --&gt; (
  handle(cmd.MdCreator),
  ... )

cmd.MdCreator --&gt; (
  dc.creator &gt; content)</code></pre>
</section>


<section id="benefits-of-lixr" class="slide level1">
    <h1>Effectiveness of LIXR</h1>
        <center>
        <img src="lixr-locs.png" style="width:50%;padding:10px;" alt="Lines of code per tag" />
        <p>Non-trivial lines of code per tag name.</p>
    </center>
</section>
<section class="slide level1">
  <h1>META-SHARE ontology</h1>

  <p>META-SHARE is a <span class="emph2">big</span> XSD schema (730 tags!)</p>

  <p>We developed a <span class="emph2">new ontology</span> based on the original XSD schema</p>

  <p>Aligning with: <span class="emph">DCAT, Dublin Core, SWRC, FOAF, Media Ontology</span></p>

</section>

<section id="data-harmonization" class="slide level1">
    <figure>
        <img src="Lotus_Water_Flower.jpg">
        <figcaption class="down"><span><span class="capt">Data harmonization</span></span><br><br><span>
          Most properties are still plain text.</span><br><br><span>
        Difficult to query and organize.</span></figcaption>
    </figure>
</section>
<section id="solution" class="slide level1">
    <figure>
        <img src="Chemicals_in_flasks.jpg">
        <figcaption class="down"><span><span class="capt">Solution</span></span><br><br><span>
            Use state-of-the-art word sense disambiguation</span></figcaption>
    </figure>
</section>
<section id="results" class="slide level1">
    <h1>Results</h1>
    <table style="width:100%;padding-top:50px;">
        <thead>
            <tr class="header">
                <th style="text-align: left;">Property</th>
                <th style="text-align: center;">Record Count</th>
                <th style="text-align: center;">Triples</th>
                <th style="text-align: center;">Accuracy</th>
            </tr>
        </thead>
        <tbody>
        <tr class="odd">
            <td style="text-align: left;">Access URL</td>
            <td style="text-align: center;">91,615 (91.6%)</td>
            <td style="text-align: center;">191,006</td>
            <td style="text-align: center;">n/a</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">Language</td>
            <td style="text-align: center;">50,781 (50.7%)</td>
            <td style="text-align: center;">98,267</td>
            <td style="text-align: center;">99.85%</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">Type</td>
            <td style="text-align: center;">15,241 (15.2%)</td>
            <td style="text-align: center;">17,894</td>
            <td style="text-align: center;">??</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">Rights</td>
            <td style="text-align: center;">3,080 (3.0%)</td>
            <td style="text-align: center;">8915</td>
            <td style="text-align: center;">95.8%</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">Usage</td>
            <td style="text-align: center;">3,397 (3.4%)</td>
            <td style="text-align: center;">4,530</td>
            <td style="text-align: center;">98-99%</td>
        </tr>
        </tbody>
    </table>
</section>
<section id="duplication" class="slide level1">
    <figure>
        <img src="sheep.jpg">
    </figure>
    <div style="position:absolute;top:0em;width:800px;">
    <h1>Duplication</h1>
    <h3 id="inter-repository-duplication">Inter-repository duplication</h3>
    <p>Errors or multiple versions/parts of the same data</p>
    <h3 id="intra-repository-duplication">Intra-repository duplication</h3>
    <p>Double recording of resource</p>
</div>
</section>
<section id="inter-repository-duplication-1" class="slide level1">
    <h1>Inter-repository duplication</h1>
    <table style="width:100%;padding-top:80px;">
        <thead>
            <tr class="header">
                <th style="text-align: left;">Resource</th>
                <th style="text-align: center;">Duplicate by Title</th>
                <th style="text-align: center;">Duplicate by URL</th>
            </tr>
        </thead>
        <tbody>
        <tr class="odd">
            <td style="text-align: left;">CLARIN*</td>
            <td style="text-align: center;">50,589</td>
            <td style="text-align: center;">20</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">Datahub</td>
            <td style="text-align: center;">0</td>
            <td style="text-align: center;">55</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">META-SHARE</td>
            <td style="text-align: center;">63</td>
            <td style="text-align: center;">967</td>
        </tr>
        </tbody>
    </table>
    <p>* Same contributing institute</p>
</section>
<section id="intra-repository-duplication-1" class="slide level1">
    <h1>Intra-repository duplication</h1>
    <table style="width:100%">
        <thead>
            <tr class="header">
                <th style="text-align: left;">Resource</th>
                <th style="text-align: center;">Resource</th>
                <th style="text-align: center;">Duplicate Titles</th>
                <th style="text-align: center;">Duplicate URLs</th>
                <th style="text-align: left;">Both</th>
            </tr>
        </thead>
        <tbody>
        <tr class="odd">
            <td style="text-align: left;">CLARIN</td>
            <td style="text-align: center;">CLARIN*</td>
            <td style="text-align: center;">1,202</td>
            <td style="text-align: center;">2,884</td>
            <td style="text-align: left;">0</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">CLARIN</td>
            <td style="text-align: center;">Datahub.io</td>
            <td style="text-align: center;">1</td>
            <td style="text-align: center;">0</td>
            <td style="text-align: left;">0</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">CLARIN</td>
            <td style="text-align: center;">LRE-Map</td>
            <td style="text-align: center;">72</td>
            <td style="text-align: center;">64</td>
            <td style="text-align: left;">0</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">CLARIN</td>
            <td style="text-align: center;">META-SHARE</td>
            <td style="text-align: center;">1,204</td>
            <td style="text-align: center;">1,228</td>
            <td style="text-align: left;">28</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">Datahub.io</td>
            <td style="text-align: center;">LRE-Map</td>
            <td style="text-align: center;">59</td>
            <td style="text-align: center;">5</td>
            <td style="text-align: left;">0</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">Datahub.io</td>
            <td style="text-align: center;">META-SHARE</td>
            <td style="text-align: center;">3</td>
            <td style="text-align: center;">0</td>
            <td style="text-align: left;">0</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">LRE-Map</td>
            <td style="text-align: center;">LRE-Map</td>
            <td style="text-align: center;">763</td>
            <td style="text-align: center;">454</td>
            <td style="text-align: left;">359</td>
        </tr>
        <tr class="even">
            <td style="text-align: left;">LRE-Map</td>
            <td style="text-align: center;">META-SHARE</td>
            <td style="text-align: center;">91</td>
            <td style="text-align: center;">51</td>
            <td style="text-align: left;">0</td>
        </tr>
        <tr class="odd">
            <td style="text-align: left;">All</td>
            <td style="text-align: center;">All</td>
            <td style="text-align: center;">3,395</td>
            <td style="text-align: center;">4,686</td>
            <td style="text-align: left;">387</td>
        </tr>
        </tbody>
    </table>
    <p>* Other contributing institute</p>
</section>
<section id="next-steps" class="slide level1">
    <figure>
        <img src="staircase.jpg">
        <figcaption class="down"><span>
          <span class="capt">Next steps</span></span><br><br><span>
          More data sources (ELRA, ISLRN, LDC, OLAC)</span><br><br><span>
            Harmonize more properties (author, subject/topic)
        </span></figcaption>
    </figure>
</section>
<section id="try-yourself" class="slide level1">
    <h1>Try for yourself</h1>
    <center style="padding-top:100px;font-size:150%;"><h2 class="emph">http://linghub.org/</h2></center>
</section>

<section class="slide level1">
  <h1 style="padding-top:240px;"><span class="emph2">Questions?</span></h1>
</section>

<!-- {{{{ dzslides core
#
#
#     __  __  __       .  __   ___  __
#    |  \  / /__` |    | |  \ |__  /__`
#    |__/ /_ .__/ |___ | |__/ |___ .__/ core :€
#
#
# The following block of code is not supposed to be edited.
# But if you want to change the behavior of these slides,
# feel free to hack it!
#
-->

<div id="progress-bar"></div>

<!-- Default Style -->
<style>
* { margin: 0; padding: 0; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
details { display: none; }
body {
    width: 800px; height: 600px;
    margin-left: -400px; margin-top: -300px;
    position: absolute; top: 50%; left: 50%;
    overflow: hidden;
}
section {
    position: absolute;
    pointer-events: none;
    width: 100%; height: 100%;
}
section[aria-selected] { pointer-events: auto; }
html { overflow: hidden; }
body { display: none; }
body.loaded { display: block; }
.incremental {visibility: hidden; }
.incremental[active] {visibility: visible; }
#progress-bar{
    bottom: 0;
    position: absolute;
    -moz-transition: width 400ms linear 0s;
    -webkit-transition: width 400ms linear 0s;
    -ms-transition: width 400ms linear 0s;
    transition: width 400ms linear 0s;
}
figure {
    width: 100%;
    height: 100%;
}
figure > * {
    position: absolute;
}
figure > img, figure > video {
    width: 100%; height: 100%;
}
</style>

<script>
var Dz = {
remoteWindows: [],
               idx: -1,
               step: 0,
               slides: null,
               progressBar : null,
               params: {
autoplay: "1"
               }
};

Dz.init = function() {
    document.body.className = "loaded";
    this.slides = $$("body > section");
    this.progressBar = $("#progress-bar");
    this.setupParams();
    this.onhashchange();
    this.setupTouchEvents();
    this.onresize();
}

Dz.setupParams = function() {
    var p = window.location.search.substr(1).split('&');
    p.forEach(function(e, i, a) {
            var keyVal = e.split('=');
            Dz.params[keyVal[0]] = decodeURIComponent(keyVal[1]);
            });
    // Specific params handling
    if (!+this.params.autoplay)
        $$.forEach($$("video"), function(v){ v.controls = true });
}

Dz.onkeydown = function(aEvent) {
    // Don't intercept keyboard shortcuts
    if (aEvent.altKey
            || aEvent.ctrlKey
            || aEvent.metaKey
            || aEvent.shiftKey) {
        return;
    }
    if ( aEvent.keyCode == 37 // left arrow
            || aEvent.keyCode == 38 // up arrow
            || aEvent.keyCode == 33 // page up
       ) {
        aEvent.preventDefault();
        this.back();
    }
    if ( aEvent.keyCode == 39 // right arrow
            || aEvent.keyCode == 40 // down arrow
            || aEvent.keyCode == 34 // page down
       ) {
        aEvent.preventDefault();
        this.forward();
    }
    if (aEvent.keyCode == 35) { // end
        aEvent.preventDefault();
        this.goEnd();
    }
    if (aEvent.keyCode == 36) { // home
        aEvent.preventDefault();
        this.goStart();
    }
    if (aEvent.keyCode == 32) { // space
        aEvent.preventDefault();
        this.toggleContent();
    }
    if (aEvent.keyCode == 70) { // f
        aEvent.preventDefault();
        this.goFullscreen();
    }
}

/* Touch Events */

Dz.setupTouchEvents = function() {
    var orgX, newX;
    var tracking = false;

    var db = document.body;
    db.addEventListener("touchstart", start.bind(this), false);
    db.addEventListener("touchmove", move.bind(this), false);

    function start(aEvent) {
        aEvent.preventDefault();
        tracking = true;
        orgX = aEvent.changedTouches[0].pageX;
    }

    function move(aEvent) {
        if (!tracking) return;
        newX = aEvent.changedTouches[0].pageX;
        if (orgX - newX > 100) {
            tracking = false;
            this.forward();
        } else {
            if (orgX - newX < -100) {
                tracking = false;
                this.back();
            }
        }
    }
}

/* Adapt the size of the slides to the window */

Dz.onresize = function() {
    var db = document.body;
    var sx = db.clientWidth / window.innerWidth;
    var sy = db.clientHeight / window.innerHeight;
    var transform = "scale(" + (1/Math.max(sx, sy)) + ")";

    db.style.MozTransform = transform;
    db.style.WebkitTransform = transform;
    db.style.OTransform = transform;
    db.style.msTransform = transform;
    db.style.transform = transform;
}


Dz.getDetails = function(aIdx) {
    var s = $("section:nth-of-type(" + aIdx + ")");
    var d = s.$("details");
    return d ? d.innerHTML : "";
}

Dz.onmessage = function(aEvent) {
    var argv = aEvent.data.split(" "), argc = argv.length;
    argv.forEach(function(e, i, a) { a[i] = decodeURIComponent(e) });
    var win = aEvent.source;
    if (argv[0] === "REGISTER" && argc === 1) {
        this.remoteWindows.push(win);
        this.postMsg(win, "REGISTERED", document.title, this.slides.length);
        this.postMsg(win, "CURSOR", this.idx + "." + this.step);
        return;
    }
    if (argv[0] === "BACK" && argc === 1)
        this.back();
    if (argv[0] === "FORWARD" && argc === 1)
        this.forward();
    if (argv[0] === "START" && argc === 1)
        this.goStart();
    if (argv[0] === "END" && argc === 1)
        this.goEnd();
    if (argv[0] === "TOGGLE_CONTENT" && argc === 1)
        this.toggleContent();
    if (argv[0] === "SET_CURSOR" && argc === 2)
        window.location.hash = "#" + argv[1];
    if (argv[0] === "GET_CURSOR" && argc === 1)
        this.postMsg(win, "CURSOR", this.idx + "." + this.step);
    if (argv[0] === "GET_NOTES" && argc === 1)
        this.postMsg(win, "NOTES", this.getDetails(this.idx));
}

Dz.toggleContent = function() {
    // If a Video is present in this new slide, play it.
    // If a Video is present in the previous slide, stop it.
    var s = $("section[aria-selected]");
    if (s) {
        var video = s.$("video");
        if (video) {
            if (video.ended || video.paused) {
                video.play();
            } else {
                video.pause();
            }
        }
    }
}

Dz.setCursor = function(aIdx, aStep) {
    // If the user change the slide number in the URL bar, jump
    // to this slide.
    aStep = (aStep != 0 && typeof aStep !== "undefined") ? "." + aStep : ".0";
    window.location.hash = "#" + aIdx + aStep;
}

Dz.onhashchange = function() {
    var cursor = window.location.hash.split("#"),
        newidx = 1,
        newstep = 0;
    if (cursor.length == 2) {
        newidx = ~~cursor[1].split(".")[0];
        newstep = ~~cursor[1].split(".")[1];
        if (newstep > Dz.slides[newidx - 1].$$('.incremental > *').length) {
            newstep = 0;
            newidx++;
        }
    }
    this.setProgress(newidx, newstep);
    if (newidx != this.idx) {
        this.setSlide(newidx);
    }
    if (newstep != this.step) {
        this.setIncremental(newstep);
    }
    for (var i = 0; i < this.remoteWindows.length; i++) {
        this.postMsg(this.remoteWindows[i], "CURSOR", this.idx + "." + this.step);
    }
}

Dz.back = function() {
    if (this.idx == 1 && this.step == 0) {
        return;
    }
    if (this.step == 0) {
        this.setCursor(this.idx - 1,
                this.slides[this.idx - 2].$$('.incremental > *').length);
    } else {
        this.setCursor(this.idx, this.step - 1);
    }
}

Dz.forward = function() {
    if (this.idx >= this.slides.length &&
            this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        return;
    }
    if (this.step >= this.slides[this.idx - 1].$$('.incremental > *').length) {
        this.setCursor(this.idx + 1, 0);
    } else {
        this.setCursor(this.idx, this.step + 1);
    }
}

Dz.goStart = function() {
    this.setCursor(1, 0);
}

Dz.goEnd = function() {
    var lastIdx = this.slides.length;
    var lastStep = this.slides[lastIdx - 1].$$('.incremental > *').length;
    this.setCursor(lastIdx, lastStep);
}

Dz.setSlide = function(aIdx) {
    this.idx = aIdx;
    var old = $("section[aria-selected]");
    var next = $("section:nth-of-type("+ this.idx +")");
    if (old) {
        old.removeAttribute("aria-selected");
        var video = old.$("video");
        if (video) {
            video.pause();
        }
    }
    if (next) {
        next.setAttribute("aria-selected", "true");
        var video = next.$("video");
        if (video && !!+this.params.autoplay) {
            video.play();
        }
    } else {
        // That should not happen
        this.idx = -1;
        // console.warn("Slide doesn't exist.");
    }
}

Dz.setIncremental = function(aStep) {
    this.step = aStep;
    var old = this.slides[this.idx - 1].$('.incremental > *[aria-selected]');
    if (old) {
        old.removeAttribute('aria-selected');
    }
    var incrementals = $$('.incremental');
    if (this.step <= 0) {
        $$.forEach(incrementals, function(aNode) {
                aNode.removeAttribute('active');
                });
        return;
    }
    var next = this.slides[this.idx - 1].$$('.incremental > *')[this.step - 1];
    if (next) {
        next.setAttribute('aria-selected', true);
        next.parentNode.setAttribute('active', true);
        var found = false;
        $$.forEach(incrementals, function(aNode) {
                if (aNode != next.parentNode)
                if (found)
                aNode.removeAttribute('active');
                else
                aNode.setAttribute('active', true);
                else
                found = true;
                });
    } else {
        setCursor(this.idx, 0);
    }
    return next;
}

Dz.goFullscreen = function() {
    var html = $('html'),
        requestFullscreen = html.requestFullscreen || html.requestFullScreen || html.mozRequestFullScreen || html.webkitRequestFullScreen;
    if (requestFullscreen) {
        requestFullscreen.apply(html);
    }
}

Dz.setProgress = function(aIdx, aStep) {
    var slide = $("section:nth-of-type("+ aIdx +")");
    if (!slide)
        return;
    var steps = slide.$$('.incremental > *').length + 1,
        slideSize = 100 / (this.slides.length - 1),
        stepSize = slideSize / steps;
    this.progressBar.style.width = ((aIdx - 1) * slideSize + aStep * stepSize) + '%';
}

Dz.postMsg = function(aWin, aMsg) { // [arg0, [arg1...]]
    aMsg = [aMsg];
    for (var i = 2; i < arguments.length; i++)
        aMsg.push(encodeURIComponent(arguments[i]));
    aWin.postMessage(aMsg.join(" "), "*");
}

function init() {
    Dz.init();
    window.onkeydown = Dz.onkeydown.bind(Dz);
    window.onresize = Dz.onresize.bind(Dz);
    window.onhashchange = Dz.onhashchange.bind(Dz);
    window.onmessage = Dz.onmessage.bind(Dz);
}

window.onload = init;
</script>


<script> // Helpers
if (!Function.prototype.bind) {
    Function.prototype.bind = function (oThis) {

        // closest thing possible to the ECMAScript 5 internal IsCallable
        // function 
        if (typeof this !== "function")
            throw new TypeError(
                    "Function.prototype.bind - what is trying to be fBound is not callable"
                    );

        var aArgs = Array.prototype.slice.call(arguments, 1),
            fToBind = this,
            fNOP = function () {},
            fBound = function () {
                return fToBind.apply( this instanceof fNOP ? this : oThis || window,
                        aArgs.concat(Array.prototype.slice.call(arguments)));
            };

        fNOP.prototype = this.prototype;
        fBound.prototype = new fNOP();

        return fBound;
    };
}

var $ = (HTMLElement.prototype.$ = function(aQuery) {
        return this.querySelector(aQuery);
        }).bind(document);

var $$ = (HTMLElement.prototype.$$ = function(aQuery) {
        return this.querySelectorAll(aQuery);
        }).bind(document);

$$.forEach = function(nodeList, fun) {
    Array.prototype.forEach.call(nodeList, fun);
}

</script>
<!-- vim: set fdm=marker: }}} -->
</body>
</html>
